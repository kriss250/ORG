
 <?php  $visa = 0; $cash = 0; $credit = 0; $room_post = 0; $bill_totals = 0; ?>
<?php $__env->startSection("contents"); ?>


<?php

$bills = isset($sales) ? $sales['bills'] : null;
$bill_items = isset($sales) ? $sales['bill_items'] : null;
$bill_pay  = isset($sales) ? $sales['bill_pay'] : null;
?>
<div class="page-contents">
 
<div class="report-filter">
<table style="width:100%">
    <tr>
        <td><h3>Day Report (Full)</h3> </td>
        <td>
           <form style="float:right" action="" class="form-inline" method="get">
                <label>Date</label> 
                <input name="startdate" type="text" value="<?php echo e(\ORG\Dates::$RESTODATE); ?>" class="date-picker form-control"> - 
                <input name="enddate" type="text" value="<?php echo e(\ORG\Dates::$RESTODATE); ?>" class="date-picker form-control">
                <label>Cashier</label> 
                    <select name="cashier" class="form-control">
                	 <option value="0">All</option>
                    <?php
                    $cashiers = App\FX::GetCashiers();
                    ?>

                    <?php if(isset($cashiers)): ?>
                        <?php foreach($cashiers as $cashier): ?>
                            <option value="<?php echo e($cashier->id); ?>"><?php echo e($cashier->username); ?></option>
                        <?php endforeach; ?>
                    <?php endif; ?>
                </select>
                <input type="submit" class="btn btn-success btn-sm" value="Go">
                <button type="button" data-dates="<?php echo e(isset($_GET['startdate']) ? $_GET['startdate'] : date('d/m/Y',strtotime(\ORG\Dates::$RESTODT))); ?> - <?php echo e(isset($_GET['startdate']) ? $_GET['startdate'] : date('d/m/Y',strtotime(\ORG\Dates::$RESTODT))); ?>" data-title="Day Report (Fulll)" class="btn btn-default report-print-btn">Print</button>
           </form> 
           
        </td>
    </tr>

     <tr>
      <td>
      <p class="text-danger"><b>Date : <?php echo e(isset($_GET['startdate']) && isset($_GET['enddate'])  ?  \App\FX::Date($_GET['startdate'])." - ".\App\FX::Date($_GET['enddate']) : \App\FX::Date(\ORG\Dates::$RESTODATE)); ?></b></p>
      </td>
    </tr>
    
</table>


</div>

<table class="table table-bordered">
    <thead>
        <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Room</th>
            <th>Items</th>
            <th>Qty</th>
            <th>U.P</th>
            <th class="diff">Total</th>
            <th>Cash</th>
            <th>Visa</th>
            <th>Check</th>
            <th>Paid</th>
        </tr>
    </thead>
    <?php if(isset($bill_items) && count($bill_items)>0): ?>
   
    <?php foreach($bill_items as $item): ?>
    <tr>
        <td><?php echo e($item->idbills); ?> </td>
        <td><?php echo e($item->customer); ?> </td>
         <td><?php echo e($item->room); ?> </td>

        <td>- <?php echo implode('<br /> - ', explode(',',$item->product)); ?> </td>
        <td><?php echo implode('<br />', explode(',',$item->quantity)); ?> </td>
        <td><?php echo implode('<br />', explode(',',$item->unitprice)); ?>  </td>
   
        <td  class="diff"><?php echo e($item->total); ?> </td>
        <?php $bill_totals +=  $item->total; ?>
        <td><?php echo e(isset($bill_pay[$item->idbills]->cash) ? $bill_pay[$item->idbills]->cash : 0); ?> </td>
        <td><?php echo e(isset($bill_pay[$item->idbills]->bank_card) ? $bill_pay[$item->idbills]->bank_card : 0); ?> </td>
  
        <td><?php echo e(isset( $bill_pay[$item->idbills]->check_amount) ? $bill_pay[$item->idbills]->check_amount : 0); ?> </td>
        <td><?php echo e($item->paid); ?> </td>
    </tr>
    <?php 

	  $visa += isset($bill_pay[$item->idbills]->bank_card) ? $bill_pay[$item->idbills]->bank_card : 0; 
      $cash +=isset($bill_pay[$item->idbills]->cash) ? $bill_pay[$item->idbills]->cash : 0; 
      $credit += ($item->status==ORG\Bill::CREDIT) ? $item->total-$item->paid: 0;
      $room_post += ($item->status==ORG\Bill::ASSIGNED) ? $item->total : 0;
    ?>

    <?php endforeach; ?>
    <tr>
        <td colspan="6"><b>TOTAL</b></td>
        <td class="diff">
            <?php echo e(number_format($bill_totals)); ?>

        </td>
        <td><?php echo e(number_format($cash)); ?></td>
        <td><?php echo e(number_format($visa)); ?></td>
        <td>0</td>
        <td><?php echo e(number_format($cash+$visa)); ?> </td>
    </tr>
    <?php else: ?> 
    <tr><td colspan="10">There is no data at the specified date</td></tr>
    <?php endif; ?>
</table>




<!-- CREDITS -->

<?php

$bills = isset($credits) ? $credits['bills'] : null;
$bill_items = isset($credits) ? $credits['bill_items'] : null;

$rooms =  isset($room_posts) ? $room_posts['rooms'] : null;
$guest = isset($room_posts) ? $room_posts['guest'] : null;
$items = isset($room_posts) ? $room_posts['items'] : null;
?>

    <?php if(isset($bills)): ?>
    <h4>CREDITS</h4>
    <table class="table-bordered table">
        <thead>
            <tr>
                <th>Customer</th>
                <th>Order No.</th>
                <th>Cashier</th>
                <th>Item</th>
                <th>Qty</th>
                <th>U.Price</th>
                <th>Total</th>
                <th>Paid</th>
                <th>Balance</th>
            </tr>
        </thead>
       <?php $due = 0; $paid=0; ?>
        <?php foreach($bills as $bill): ?>
        
            <?php $items_no = count($bill_items[$bill->idbills]); ?>
            <?php $i = 0; $due +=$bill->bill_total; $paid +=$bill->amount_paid; ?>
     
                <?php foreach($bill_items[$bill->idbills] as $item): ?>
            

                <tr>
                    <?php if($i==0): ?>
                    <td rowspan="<?php echo e($items_no); ?>">
                        <?php echo e($bill->customer); ?>

                    </td>
                

                    <td rowspan="<?php echo e($items_no); ?>">
                        <?php echo e($bill->idbills); ?>

                    </td>

                    <td rowspan="<?php echo e($items_no); ?>">
                        <?php echo e($bill->username); ?>

                    </td>
                    <?php endif; ?>
                    <td><?php echo e($item->product_name); ?></td>
                    <td><?php echo e($item->qty); ?></td>
                    <td><?php echo e($item->unit_price); ?></td>

                    <?php if($i==0): ?>
                    <td rowspan="<?php echo e($items_no); ?>"><?php echo e(number_format($bill->bill_total)); ?> </td>
                    <td rowspan="<?php echo e($items_no); ?>"><?php echo e(number_format($bill->amount_paid)); ?> </td>
                    <td rowspan="<?php echo e($items_no); ?>"><?php echo e(number_format($bill->bill_total-$bill->amount_paid)); ?> </td>
                    <?php endif; ?>
                </tr>
        <?php $i++; ?>
                <?php endforeach; ?>
           
      
        
        <?php endforeach; ?>
        <tr>
            <td colspan="6"><b>TOTAL</b></td>
            <td><b><?php echo e(number_format($due)); ?></b></td>
            <td><b><?php echo e(number_format($paid)); ?></b></td>
            <td><b><?php echo e(number_format($due-$paid)); ?></b></td>
        </tr>
    </table>
    <?php endif; ?>


<!-- ROOM POSTS -->
    <h4>Room Posts</h4>
<?php if(isset($rooms)): ?>
     
    <table class="table-bordered table">
<thead>
   <tr>
       <th>customer</th>
        <th>room</th>
        <th class="text-center" colspan="4">order</th>
        <th>Total</th>
    </tr> 
</thead>
    <?php $tt2=0; $GT=0; ?>

    <?php foreach($rooms as $room): ?>
    <?php 
        $items_count = 0;
        $items_col = "";
        $tr = "";
        $room_sub_total = 0;

        foreach ($items[$room->room] as $item) { //loop through room bills
            $bill_sub_total = 0;
            $sub_items = explode(',', $item->item);
            $items_count+=2;
            $tr .= "<tr>
                        <th class='text-center' style='background:rgb(248, 248, 248)' colspan='4'>Order No. ".$item->bill_id."</th>
                    </tr>";

                foreach ($sub_items as $sub_item) { //loop  through each room bill items
                    list($item_name,$qty,$price) = explode(':', $sub_item);
                    $sub_total = 0;
                    $sub_total = $qty * $price;
                    $room_sub_total +=$sub_total;
                    $bill_sub_total += $sub_total;
                    $items_count+=1;
                    $tr .="<tr>
                            <td>$item_name</td>
                            <td>$qty</td>
                            <td>$price</td> 
                            <td>$sub_total</td> 
                        </tr>";
                }



             $tr .= "<tr> <td colspan='3'><b>T.P</b></td>
                            <th class='text-right'>".number_format($bill_sub_total)."</th>
                        </tr>";   

                       
         }
//$items_count++;

    ?>
    <tr class="room_end">
         <?php if(isset($guest)): ?>
             <td rowspan="<?php echo e($items_count+1); ?>"><?php echo e($guest[$room->room][0]->guest); ?> <p style="font-size:12px;">(<?php echo e($guest[$room->room][0]->Account); ?>)</p> </td>
        <?php endif; ?>
        <td rowspan="<?php echo e($items_count+1); ?>"><?php echo e($room->room); ?></td>
        <td style="padding: 0"  colspan="4"> </td>
        <td rowspan="<?php echo e($items_count+1); ?>"><?php echo e(number_format($room_sub_total)); ?></td>
    </tr>

    <?php $GT +=$room_sub_total; ?>

   <?php echo $tr; ?>

    <?php endforeach; ?>

<tr>
<td colspan="6"><b>TOTAL</b></td>
<td><b><?php echo e(number_format($GT)); ?></b></td>
</tr>



</table>

<?php endif; ?>

<!-- Summary -->
    <h4>Summary</h4>
    <?php if(isset($bills) && count($bills)>0 ): ?>
   
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Debts (Unpaid)</th><th>Paid</th><th>Room Posts</th><th>Visa</th> <th>cash</th><th>Total Sales</th>
        </tr>
    </thead>
    <tr>
       
        <td>
            <!-- Debts -->
            <?php echo e(number_format($credit)); ?> 
        </td>
        <td>
            <!--Paid -->
            <?php echo e(number_format($cash+$visa)); ?>

        </td>

        <td>
            <!-- Room Posts -->
            <?php echo e($room_post); ?>

        </td>

        <td>
            <!-- Visa -->
            <?php echo e(number_format($visa)); ?>


        </td>

        <td>
            <!-- Cash -->
             <?php echo e(number_format($cash)); ?>

        </td>

        <td> <?php echo e(number_format( $room_post + $credit +$visa+$cash)); ?></td>
    </tr>
</table>

<?php endif; ?>

<div class="text-center print-footer">
       <table style="margin-bottom:85px;width:100%;" class="table">
           <tr>
               <td>
                   Cashier
               </td>

               <td>
                   CONTROLLER
               </td>

               <td>
                    ACCOUNTANT
               </td>

               <td>
                   DAF
               </td>

               <td>
                   G. MANAGER
               </td>
           </tr>
       </table>
        <div class="clearfix"></div>
    </div>
</div>
<?php $__env->stopSection(); ?>
<?php echo $__env->make("Backoffice.Master", array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>